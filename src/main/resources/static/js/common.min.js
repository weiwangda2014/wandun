/*!
 * Copyright &copy; 2015-2020 王玮 All rights reserved.
 *
 * 通用公共方法
 * @author 云南万盾科技有限公司
 * @version 2014-4-29
 */
$(document).ready(function(){$('input[type="checkbox"].i-checks, input[type="radio"].i-checks').iCheck({handle:"checkbox",checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal-blue"});});function getQueryString(name,url){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)","i");if(!url||url==""){url=window.location.search;}else{url=url.substring(url.indexOf("?"));}r=url.substr(1).match(reg);if(r!=null){return unescape(r[2]);}return null;}function getDictLabel(data,value,defaultValue){for(var i=0;i<data.length;i++){var row=data[i];if(row.value==value){return row.label;}}return defaultValue;}function windowOpen(url,name,width,height){var top=parseInt((window.screen.height-height)/2,10),left=parseInt((window.screen.width-width)/2,10),options="location=no,menubar=no,toolbar=no,dependent=yes,minimizable=no,modal=yes,alwaysRaised=yes,resizable=yes,scrollbars=yes,width="+width+",height="+height+",top="+top+",left="+left;window.open(url,name,options);}function openDialog(title,url,width,height,target){top.layer.open({type:2,area:[width,height],title:title,maxmin:true,content:url,btn:["确定","关闭"],yes:function(index,layero){var body=top.layer.getChildFrame("body",index);var iframeWin=layero.find("iframe")[0];var inputForm=body.find("#inputForm");var top_iframe;if(target){top_iframe=target;}else{top_iframe=top.getActiveTab().attr("name");}inputForm.attr("target",top_iframe);if($.validateForm(inputForm).form()){$.doSubmit(inputForm,index);}return false;},cancel:function(index){}});}function openDialogPrint(title,url,width,height,target,printurl){top.layer.open({type:2,area:[width,height],title:title,maxmin:true,content:url,btn:["确定","确定并打印","关闭"],yes:function(index,layero){var body=top.layer.getChildFrame("body",index);var iframeWin=layero.find("iframe")[0];var inputForm=body.find("#inputForm");var top_iframe;if(target){top_iframe=target;}else{top_iframe=top.getActiveTab().attr("name");}inputForm.attr("target",top_iframe);if($.validateForm(inputForm).form()){$.doSubmit(inputForm,index);}return false;},btn2:function(index,layero){var body=top.layer.getChildFrame("body",index);var iframeWin=layero.find("iframe")[0];var inputForm=body.find("#inputForm");var top_iframe;if(target){top_iframe=target;}else{top_iframe=top.getActiveTab().attr("name");}inputForm.attr("target",top_iframe);if($.validateForm(inputForm).form()){$.doPrintSubmit(inputForm,printurl,index);}return false;},cancel:function(index){}});}function openDialogView(title,url,width,height){top.layer.open({type:2,area:[width,height],title:title,maxmin:true,content:url,btn:["关闭"],cancel:function(index){}});}function search(){$("#pageNo").val(0);$("#searchForm").submit();return false;}function reset(){$("#pageNo").val(0);$("#searchForm div.form-group input").val("");$("#searchForm div.form-group select").val("");$("#searchForm").submit();return false;}function sortOrRefresh(){$("#searchForm").submit();return false;}function page(n,s){$("#pageNo").val(n);$("#pageSize").val(s);$("#searchForm").submit();$("span.page-size").text(s);return false;}(function($){$.checkLogin=function(){var result=false;$.ajax({url:global.ctx+"/login/check.html",type:"GET",dataType:"json",cache:false,async:false,success:function(data){result=data;}});return result;};$.redirectLogin=function(redirectUrl,message){var href=global.ctx+"/login/index.html";if(redirectUrl!=null){href+="?redirectUrl="+encodeURIComponent(redirectUrl);}if(message!=null){$.message("warn",message);setTimeout(function(){location.href=href;},1000);}else{location.href=href;}};$.message=function(){var message={};if($.isPlainObject(arguments[0])){message=arguments[0];}else{if(typeof arguments[0]==="string"&&typeof arguments[1]==="string"){message.type=arguments[0];message.content=arguments[1];}else{return false;}}if(message.type==null||message.content==null){return false;}switch(message.type){case"error":top.layer.alert(message.content,{icon:2});break;case"warn":top.layer.alert(message.content,{icon:3});break;default:top.layer.alert(message.content,{icon:1});}};$.validateForm=function(){return arguments[0].validate();};$.doSubmit=function(form,index){form.ajaxSubmit({dataType:"json",forceSync:true,success:function(data){top.layer.close(this.layerIndex);switch(data.type){case"error":top.layer.alert(data.content,{icon:2});break;case"warn":top.layer.alert(data.content,{icon:3});break;default:top.layer.alert(data.content,{icon:1});parent.layer.close(index);var timestamp=new Date().getTime();top.getActiveTab().attr("src",top.getActiveTab().attr("src")+"?timestamp="+timestamp);top.getActiveTab()[0].contentDocument.forms.searchForm.submit();}},beforeSubmit:function(arr,$form,options){this.layerIndex=top.layer.load(0,{shade:[0.5,"#393D49"]});}});};$.doPrintSubmit=function(form,url,index){form.ajaxSubmit({dataType:"json",forceSync:true,success:function(json){top.layer.close(this.layerIndex);switch(json.type){case"error":top.layer.alert(json.content,{icon:2});break;case"warn":top.layer.alert(json.content,{icon:3});break;default:top.layer.alert(json.content,{icon:1});parent.layer.close(index);var sn=json.data.sn;var print=top.layer.open({type:2,area:["100%","100%"],title:"打印",maxmin:true,content:url+"?sn="+sn});top.layer.full(print);var timestamp=new Date().getTime();top.getActiveTab().attr("src",top.getActiveTab().attr("src")+"?timestamp="+timestamp);top.getActiveTab()[0].contentDocument.forms.searchForm.submit();}},beforeSubmit:function(arr,$form,options){this.layerIndex=top.layer.load(0,{shade:[0.5,"#393D49"]});}});};})(jQuery);if($.validator!=null){$.extend($.validator.messages,{required:"必填",email:"E-mail格式错误",url:"网址格式错误",date:"日期格式错误",dateISO:"日期格式错误",pointcard:"信用卡格式错误",number:"只允许输入数字",digits:"只允许输入零或正整数",minlength:$.validator.format("长度不允许小于{0}"),maxlength:$.validator.format("长度不允许大于{0}"),rangelength:$.validator.format("长度必须在{0}-{1}之间"),min:$.validator.format("不允许小于{0}"),max:$.validator.format("不允许大于{0}"),range:$.validator.format("必须在{0}-{1}之间"),accept:"输入后缀错误",equalTo:"两次输入不一致",remote:"输入错误",integer:"只允许输入整数",positive:"只允许输入正数",negative:"只允许输入负数",decimal:"数值超出了允许范围",pattern:"格式错误",extension:"文件格式错误"});$.validator.setDefaults({errorClass:"fieldError",ignore:".ignore",ignoreTitle:true,errorPlacement:function(error,element){var fieldSet=element.closest("span.fieldSet");if(fieldSet.length>0){error.appendTo(fieldSet);}else{error.insertAfter(element);}},submitHandler:function(form){$(form).find("input:submit").prop("disabled",true);$(form).ajaxSubmit({dataType:"json",success:function(data){if(data.type=="success"){top.layer.alert(data.content,{icon:1});}else{if(data.type==="warn"){top.layer.alert(data.content,{icon:3});}else{top.layer.alert(data.content,{icon:2});}}top.layer.close(this.layerIndex);var index=parent.layer.getFrameIndex(window.name);parent.layer.close(index);},beforeSubmit:function(arr,$form,options){this.layerIndex=top.layer.load(0,{shade:[0.5,"#393D49"]});}});}});}